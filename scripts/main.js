import{askPrompt}from "./linguagpt.js";import DOMPurify from "https://cdn.jsdelivr.net/npm/dompurify/+esm";const msgInput=document.getElementById("msgInput");const msgArea=document.getElementById("msgArea");const threeDots=document.getElementById("three_dots");const dropdown=document.getElementById("language");async function showMessage(msg,userFlag){threeDots.style.display="none";const newMsg=document.createElement("div");const newMsgBody=document.createElement("div");newMsgBody.classList.add("markdown-body");newMsgBody.innerText=msg;await MathJax.typesetPromise([newMsgBody]);newMsg.appendChild(newMsgBody);newMsg.dataset.user=userFlag;newMsg.classList.add("message");msgArea.appendChild(newMsg);return newMsg;}
async function showHTMLMessage(htmlMsg,userFlag){threeDots.style.display="none";const newMsg=document.createElement("div");const newMsgBody=document.createElement("div");newMsgBody.classList.add("markdown-body");newMsgBody.innerHTML=DOMPurify.sanitize(htmlMsg);await MathJax.typesetPromise([newMsgBody]);newMsg.appendChild(newMsgBody);newMsg.dataset.user=userFlag;newMsg.classList.add("message");msgArea.appendChild(newMsg);return newMsg;}
async function showError(error){const msg=await showMessage(error,false);msg.classList.add("errorMessage");}
document.getElementById("chatForm").onsubmit=async(e)=>{e.preventDefault();const msg=msgInput.value;if(!msg){return;}
msgInput.value="";await showMessage(msg,true);threeDots.style.display="revert";const targetLanguage=dropdown.value;const{htmlAnswer,error}=await askPrompt(msg,targetLanguage);if(error!==undefined){await showError(error.toString());return;}
await showHTMLMessage(htmlAnswer,false);};const languagesDict={en:"English",af:"Afrikaans",sq:"Albanian",am:"Amharic",ar:"Arabic",hy:"Armenian",as:"Assamese",ay:"Aymara",az:"Azerbaijani",bm:"Bambara",eu:"Basque",be:"Belarusian",bn:"Bengali",bho:"Bhojpuri",bs:"Bosnian",bg:"Bulgarian",ca:"Catalan",ceb:"Cebuano",ny:"Chichewa","zh-CN":"Chinese (Simplified)",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",dv:"Dhivehi",doi:"Dogri",nl:"Dutch",eo:"Esperanto",et:"Estonian",ee:"Ewe",tl:"Filipino",fi:"Finnish",fr:"French",fy:"Frisian",gl:"Galician",ka:"Georgian",de:"German",el:"Greek",gn:"Guarani",gu:"Gujarati",ht:"Haitian Creole",ha:"Hausa",haw:"Hawaiian",iw:"Hebrew",hi:"Hindi",hmn:"Hmong",hu:"Hungarian",is:"Icelandic",ig:"Igbo",ilo:"Ilocano",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",jw:"Javanese",kn:"Kannada",kk:"Kazakh",km:"Khmer",rw:"Kinyarwanda",gom:"Konkani",ko:"Korean",kri:"Krio",ku:"Kurdish (Kurmanji)",ckb:"Kurdish (Sorani)",ky:"Kyrgyz",lo:"Lao",la:"Latin",lv:"Latvian",ln:"Lingala",lt:"Lithuanian",lg:"Luganda",lb:"Luxembourgish",mk:"Macedonian",mai:"Maithili",mg:"Malagasy",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi","mni-Mtei":"Meiteilon (Manipuri)",lus:"Mizo",mn:"Mongolian",my:"Myanmar (Burmese)",ne:"Nepali",no:"Norwegian",or:"Odia (Oriya)",om:"Oromo",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese",pa:"Punjabi",qu:"Quechua",ro:"Romanian",ru:"Russian",sm:"Samoan",sa:"Sanskrit",gd:"Scots Gaelic",nso:"Sepedi",sr:"Serbian",st:"Sesotho",sn:"Shona",sd:"Sindhi",si:"Sinhala",sk:"Slovak",sl:"Slovenian",so:"Somali",es:"Spanish",su:"Sundanese",sw:"Swahili",sv:"Swedish",tg:"Tajik",ta:"Tamil",tt:"Tatar",te:"Telugu",th:"Thai",ti:"Tigrinya",ts:"Tsonga",tr:"Turkish",tk:"Turkmen",ak:"Twi",uk:"Ukrainian",ur:"Urdu",ug:"Uyghur",uz:"Uzbek",vi:"Vietnamese",cy:"Welsh",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",zu:"Zulu",};for(const key in languagesDict){const option=document.createElement("option");option.setAttribute("value",key);option.textContent=languagesDict[key];dropdown.appendChild(option);}
const options=dropdown.children;for(const option of options){if(window.location.pathname.split('/')[1].indexOf(option.value.toLowerCase())!==-1){option.defaultSelected=true;}};